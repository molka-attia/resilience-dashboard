<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>K8s Test Chamber</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #1867b7;
      --secondary: #A29BFE;
      --accent: #FF7675;
      --success: #4CAF50;
      --warning: #FFC107;
      --bg: #0F0F1E;
      --card-bg: rgba(255, 255, 255, 0.08);
      --sidebar-bg: rgba(16, 16, 32, 0.95);
      --text-color: #fff;
      --input-bg: rgba(255, 255, 255, 0.06);
      --border-color: rgba(255, 255, 255, 0.1);
      --nav-hover: rgba(108, 92, 231, 0.1);
      --shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    .light-mode {
      --primary: #1867b7;
      --secondary: #7986CB;
      --accent: #FF5252;
      --success: #388E3C;
      --warning: #FFA000;
      --bg: #f2f4f8;
      --card-bg: #ffffff;
      --sidebar-bg: #ffffff;
      --text-color: #2c2c2c;
      --input-bg: #f0f1f5;
      --border-color: #d0d0d0;
      --nav-hover: #e8eaf6;
      --shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      transition: var(--transition);
    }

    .sidebar {
      width: 280px;
      height: 100vh;
      background: var(--sidebar-bg);
      padding: 2rem 1.5rem;
      position: fixed;
      left: 0;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(12px);
      box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
    }

    .sidebar h1 {
      font-size: 1.8rem;
      margin-bottom: 2rem;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav-links {
      flex-grow: 1;
    }

    .nav-link {
      color: var(--text-color);
      opacity: 0.9;
      text-decoration: none;
      margin: 0.8rem 0;
      padding: 0.8rem 1.2rem;
      border-radius: 12px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
      overflow: hidden;
    }

    .nav-link::before {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      width: 0;
      height: 2px;
      background: var(--primary);
      transition: width 0.3s ease;
    }

    .nav-link:hover {
      background: var(--nav-hover);
      transform: translateX(8px);
    }

    .nav-link.active {
      background: var(--nav-hover);
      font-weight: 600;
    }

    .nav-link:hover::before {
      width: 100%;
    }

    .theme-toggle {
      background: var(--card-bg);
      border: none;
      padding: 0.8rem 1.2rem;
      border-radius: 12px;
      color: var(--text-color);
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: auto;
      margin-bottom: 1rem;
    }

    .theme-toggle:hover {
      background: var(--nav-hover);
    }

    .copyright {
      margin-top: 1rem;
      font-size: 0.8rem;
      text-align: center;
      opacity: 0.6;
    }

    .main {
      flex: 1;
      margin-left: 280px;
      min-height: 100vh;
      padding: 2rem;
      animation: fadeIn 0.7s ease;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .dashboard-title {
      font-size: 1.8rem;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .category-nav {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      overflow-x: auto;
      padding-bottom: 0.5rem;
    }

    .category-btn {
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      background: var(--input-bg);
      border: none;
      color: var(--text-color);
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
      transition: var(--transition);
    }

    .category-btn:hover {
      background: var(--nav-hover);
    }

    .category-btn.active {
      background: linear-gradient(to right, var(--primary), var(--secondary));
      color: white;
    }

    .section-container {
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .section-container.active {
      display: block;
    }

    .section-title {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .section-description {
      opacity: 0.8;
      margin-bottom: 2rem;
      line-height: 1.6;
      max-width: 800px;
    }

    .form-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 2rem;
      box-shadow: var(--shadow);
      backdrop-filter: blur(24px);
      transition: var(--transition);
      width: 100%;
      max-width: 700px;
      margin: 0 auto;
    }

    .form-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    }

    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .card-icon {
      font-size: 1.8rem;
      margin-right: 1rem;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .card-title {
      font-size: 1.4rem;
      font-weight: 600;
    }

    .input-group {
      position: relative;
      margin-bottom: 1.5rem;
    }

    .input-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      color: var(--text-color);
      opacity: 0.8;
    }

    .input-group input,
    .input-group select {
      width: 100%;
      padding: 0.9rem 1rem;
      border: 1px solid var(--border-color);
      background: var(--input-bg);
      color: var(--text-color);
      border-radius: 10px;
      font-size: 1rem;
      transition: var(--transition);
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.15);
    }

    .form-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .btn {
      padding: 1rem 1.5rem;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: linear-gradient(to right, var(--primary), var(--secondary));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(108, 92, 231, 0.4);
    }

    .btn-danger {
      background: linear-gradient(to right, var(--accent), #FF5252);
      color: white;
    }

    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 118, 117, 0.4);
    }

    .btn-success {
      background: linear-gradient(to right, var(--success), #4CAF50);
      color: white;
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
    }

    .btn-warning {
      background: linear-gradient(to right, var(--warning), #FFC107);
      color: #2c2c2c;
    }

    .btn-warning:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 193, 7, 0.4);
    }

    .notification {
      position: fixed;
      top: 2rem;
      right: 2rem;
      padding: 1rem 1.5rem;
      border-left: 4px solid var(--primary);
      border-radius: 8px;
      background: var(--card-bg);
      box-shadow: var(--shadow);
      transition: opacity 0.5s ease, transform 0.5s ease;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 0.8rem;
      opacity: 0;
      transform: translateY(-20px);
      max-width: 400px;
    }

    .notification.show {
      opacity: 1;
      transform: translateY(0);
    }

    .notification-icon {
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    .notification-close {
      background: none;
      border: none;
      color: var(--text-color);
      opacity: 0.6;
      cursor: pointer;
      font-size: 1rem;
      margin-left: auto;
      transition: opacity 0.3s ease;
    }

    .notification-close:hover {
      opacity: 1;
    }

    .action-buttons {
      display: flex;
      gap: 1rem;
    }

    .action-buttons .btn {
      padding: 0.75rem 1.25rem;
      flex: none;
      width: auto;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 1024px) {
      .form-card {
        max-width: 600px;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        height: auto;
        position: static;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
      }

      .sidebar h1 {
        margin-bottom: 0;
        font-size: 1.5rem;
      }

      .nav-links {
        display: none;
      }

      .theme-toggle {
        margin-top: 0;
      }

      .copyright {
        display: none;
      }

      .main {
        margin-left: 0;
        padding: 1rem;
      }

      .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }

      .form-card {
        max-width: 100%;
        padding: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="sidebar">
 <div class="nav-links">
      <h1>‚ö° K8s Chaos</h1>
      <a href="index.html" class="nav-link">
        <span>üìä Chaos Graph</span>
      </a>
      <a href="kpi.html" class="nav-link">
        <span>üìà KPI Dashboard</span>
      </a>
      <a href="faultsinjections.html" class="nav-link">
        <span>üß™ Fault Injection</span>
      </a>
      <a href="metrics-dash.html" class="nav-link">
        <span>üìè CPU Usage</span>
      </a>
      <a href="metrics-system-usage.html" class="nav-link">
        <span>üñ•Ô∏è CPU System</span>
      </a>
      <a href="Memory_RSS.html" class="nav-link">
        <span>üìç Resident Memory</span>
      </a>
      <a href="memory_working_set_bytes.html" class="nav-link">
        <span>üéØ Active Memory</span>
      </a>
      <a href="container_network_receive_bytes.html" class="nav-link">
        <span>üåê Network Receive</span>
      </a>
      <a href="network_transmit_packets.html" class="nav-link">
        <span>üì° Network Transmit</span>
      </a>
      
      <a href="events.html" class="nav-link">
        <span>üìã Events</span>
      </a>
    </div>
    <button class="theme-toggle" id="themeToggle">
      <span id="themeIcon">üåì</span>
      <span>Toggle Theme</span>
    </button>
    <div class="copyright">¬© 2025 UPM Kubernetes Dashboard</div>
  </div>

  <div class="main">
    <div class="dashboard-header">
      <h2 class="dashboard-title">Fault Injection Dashboard</h2>
      <div class="action-buttons">
        <button class="btn btn-primary" onclick="window.location.href='faultsinjections.html'">
          <span>üß™</span> Fault Injection
        </button>
        <button class="btn btn-success" onclick="window.location.href='nwreport.html'">
          <span>üìä</span> Current Status
        </button>
      </div>
    </div>

    <div class="category-nav">
      <button class="category-btn active" data-section="cpu-stress">CPU Stress</button>
      <button class="category-btn" data-section="memory-stress">Memory Stress</button>
      <button class="category-btn" data-section="network-loss">Network Loss</button>
      <button class="category-btn" data-section="network-delay">Network Delay</button>
      <button class="category-btn" data-section="istio-delay">Istio Delay</button>
      <button class="category-btn" data-section="cleanup">Load Generator</button>
    </div>

    <div id="cpu-stress" class="section-container active">
      <h3 class="section-title">üî• CPU Stress</h3>
      <p class="section-description">
        Simulate CPU exhaustion by stressing the CPU cores of your target service.
      </p>
      <div class="form-card">
        <div class="card-header">
          <div class="card-icon">üî•</div>
          <h3 class="card-title">CPU Stress Injection</h3>
        </div>
        <div class="input-group">
          <label for="cpu-namespace">Namespace</label>
          <input type="text" id="cpu-namespace" placeholder="molka2" value="molka2" />
        </div>
        <div class="input-group">
          <label for="cpu-microservice">Microservice</label>
          <input type="text" id="cpu-microservice" placeholder="checkoutservice" />
        </div>
        <div class="input-group">
          <label for="cpu-duration">Duration (seconds)</label>
          <input type="number" id="cpu-duration" placeholder="10" value="10" min="1" />
        </div>
        <div class="input-group">
          <label for="cpu-waitBefore">Wait Before Injecting (in seconds):</label>
          <input type="number" id="cpu-waitBefore" placeholder="0" value="0" min="0" />
        </div>
        <div class="form-actions">
          <button class="btn btn-warning" onclick="injectCpuStress()">
            <span>üî•</span> Stress CPU
          </button>
        </div>
      </div>
    </div>

    <div id="memory-stress" class="section-container">
      <h3 class="section-title">üß† Memory Stress</h3>
      <p class="section-description">
        Simulate memory exhaustion by allocating specified amounts of memory.
      </p>
      <div class="form-card">
        <div class="card-header">
          <div class="card-icon">üß†</div>
          <h3 class="card-title">Memory Stress Injection</h3>
        </div>
        <div class="input-group">
          <label for="mem-namespace">Namespace</label>
          <input type="text" id="mem-namespace" name="namespace" value="default" />
        </div>
        <div class="input-group">
          <label for="mem-service">Microservice</label>
          <input type="text" id="mem-service" name="microservice" value="recommendationservice" />
        </div>
        <div class="input-group">
          <label for="memSize">Memory size (e.g., <code>256M</code>):</label>
          <input type="text" id="mem-amount" name="mem-amount" value="256M" min="10" max="8192" />
        </div>
        <div class="input-group">
          <label for="mem-duration">Duration (seconds)</label>
          <input type="text" id="mem-duration" name="mem-duration" value="60" min="5" max="3600" />
        </div>
        <div class="input-group">
          <label for="mem-waitbefore">Wait before injection (seconds):</label>
          <input type="number" id="mem-waitBefore" name="mem-waitBefore" value="4" min="1" max="16" />
        </div>
        <div class="form-actions">
          <button class="btn btn-warning" onclick="injectMemoryStress()">
            <span>üß†</span> Stress Memory
          </button>
        </div>
      </div>
    </div>

    <div id="network-loss" class="section-container">
      <h3 class="section-title">üìâ Network Loss (tc)</h3>
      <p class="section-description">
        Simulate network packet loss using Linux traffic control (tc).
      </p>
      <div class="form-card">
        <div class="card-header">
          <div class="card-icon">üìâ</div>
          <h3 class="card-title">Network Packet Loss</h3>
        </div>
        <div class="input-group">
          <label for="loss-namespace">Namespace</label>
          <input type="text" id="loss-namespace" name="loss-namespace" value="default" />
        </div>
        <div class="input-group">
          <label for="loss-service">Microservice</label>
          <input type="text" id="loss-microservice" name="loss-microservice" value="shippingservice" />
        </div>
        <div class="input-group">
          <label for="loss-percent">Packet Loss (%)</label>
          <input type="number" id="loss-percent" name="loss-percent" value="20" min="0" max="100" />
        </div>
        <div class="input-group">
          <label for="loss-duration">Duration (seconds):</label>
          <input type="number" id="loss-duration" name="duration" value="10" min="1" required />
        </div>
        <div class="input-group">
          <label for="loss-waitBefore">Wait Before Start (seconds, optional):</label>
          <input type="number" id="loss-waitBefore" name="waitBefore" value="0" min="0" />
        </div>
        <div class="form-actions">
          <button class="btn btn-primary" onclick="injectNetworkLoss()">
            <span>üìâ</span> Inject Loss
          </button>
        </div>
      </div>
    </div>

    <div id="network-delay" class="section-container">
      <h3 class="section-title">‚è±Ô∏è Network Delay (tc)</h3>
      <p class="section-description">
        Simulate network latency using Linux traffic control (tc).
      </p>
      <div class="form-card">
        <div class="card-header">
          <div class="card-icon">‚è±Ô∏è</div>
          <h3 class="card-title">Network Delay</h3>
        </div>
        <div class="input-group">
          <label for="netdelay-namespace">Namespace</label>
          <input type="text" id="netdelay-namespace" name="namespace" value="default" />
        </div>
        <div class="input-group">
          <label for="netdelay-microservice">Microservice</label>
          <input type="text" id="netdelay-microservice" name="microservice" value="shippingservice" />
        </div>
        <div class="input-group">
          <label for="netdelay-ms">Delay (ms)</label>
          <input type="number" id="netdelay-ms" name="delay-ms" value="200" min="0" max="5000" />
        </div>
        <div class="input-group">
          <label for="netdelay-duration">Duration (s)</label>
          <input type="number" id="netdelay-duration" name="duration" value="10" min="0" max="10000" />
        </div>
        <div class="input-group">
          <label for="netdelay-waitBefore">Activation Delay (s)</label>
          <input type="number" id="netdelay-waitBefore" name="waitBefore" value="0" min="0" max="10000" />
        </div>
        <div class="form-actions">
          <button class="btn btn-primary" onclick="injectNetworkDelay()">
            <span>‚è±Ô∏è</span> Inject Delay
          </button>
        </div>
      </div>
    </div>

    <div id="istio-delay" class="section-container">
      <h3 class="section-title">üõ°Ô∏è Istio Delay</h3>
      <p class="section-description">
        Inject HTTP-level delays for specific services using Istio's fault injection.
      </p>
      <div class="form-card">
        <div class="card-header">
          <div class="card-icon">üõ°Ô∏è</div>
          <h3 class="card-title">Istio Delay Injection</h3>
        </div>
        <div class="input-group">
          <label for="istio-namespace">Namespace</label>
          <input type="text" id="istio-namespace" name="namespace" value="default" />
        </div>
        <div class="input-group">
          <label for="istio-service">Services (comma-separated):</label>
          <input type="text" id="istio-service" name="source" value="frontend" />
        </div>
        <div class="input-group">
          <label for="istioDelayMs">Istio Delay (ms):</label>
          <input type="text" id="istioDelayMs" name="destination" value="200" min="0" />
        </div>
        <div class="input-group">
          <label for="istio-delay">Duration (seconds)</label>
          <input type="number" id="istio-duration" name="delay" value="200" min="0" max="10000" />
        </div>
        <div class="input-group">
          <label for="istio-waitBefore">Wait Before Injection (seconds):</label>
          <input type="number" id="istio-waitBefore" name="percent" value="50" min="0" max="100" />
        </div>
        <div class="form-actions">
          <button class="btn btn-primary" onclick="injectIstioDelay()">
            <span>üõ°Ô∏è</span> Inject Delay
          </button>
        </div>
      </div>
    </div>

    <div id="cleanup" class="section-container">
      <h3 class="section-title">üèãÔ∏è Scale Load Generator</h3>
      <p class="section-description">
        Remove active faults from your cluster by scaling load generator back to 1 replica.
      </p>
      <div class="form-card">
        <div class="card-header">
          <div class="card-icon">üèãÔ∏è</div>
          <h3 class="card-title">Scale Load Generator</h3>
        </div>
        <div class="input-group">
          <label for="load-namespace">Namespace</label>
          <input type="text" id="load-namespace" name="namespace" value="default" />
        </div>
        <div class="input-group">
          <label for="load-users">Number of Users (replicas)</label>
          <input type="number" id="load-users" name="users" value="1" min="1" max="100" />
        </div>
        <div class="input-group">
          <label for="load-duration">Duration (seconds)</label>
          <input type="number" id="load-duration" name="duration" value="60" min="1" />
        </div>
        <div class="form-actions">
          <button class="btn btn-danger" onclick="cleanupLoadGenerator(event)">
            <span>üèãÔ∏è</span> Load
          </button>
        </div>
      </div>
    </div>

    <div id="notification" class="notification">
      <span class="notification-icon">‚úÖ</span>
      <span class="notification-message">Operation completed successfully</span>
      <button class="notification-close" onclick="hideNotification()">‚úñ</button>
    </div>
  </div>

  <script>
    // Theme toggle logic
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');

    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('light-mode');
      const isLight = document.body.classList.contains('light-mode');
      localStorage.setItem('lightMode', isLight);
      themeIcon.textContent = isLight ? 'üåû' : 'üåô';
    });

    if (localStorage.getItem('lightMode') === 'true') {
      document.body.classList.add('light-mode');
      themeIcon.textContent = 'üåû';
    }

    // Category switching logic
    const categoryBtns = document.querySelectorAll('.category-btn');
    const sections = document.querySelectorAll('.section-container');

    categoryBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        categoryBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        const sectionId = btn.dataset.section;
        sections.forEach(section => {
          section.classList.remove('active');
          if (section.id === sectionId) {
            section.classList.add('active');
          }
        });
      });
    });

    // Notification logic
    let notificationTimeout = null;

    function showNotification(message, success = true) {
      const notif = document.getElementById('notification');
      const icon = notif.querySelector('.notification-icon');
      const msg = notif.querySelector('.notification-message');

      // Clear any existing timeout to prevent stuck notifications
      if (notificationTimeout) {
        clearTimeout(notificationTimeout);
      }

      // Update notification content
      icon.textContent = success ? '‚úÖ' : '‚ùå';
      icon.style.color = success ? 'var(--success)' : 'var(--accent)';
      msg.textContent = message;
      notif.style.borderColor = success ? 'var(--success)' : 'var(--accent)';

      // Show notification
      notif.classList.add('show');

      // Auto-hide after 5 seconds
      notificationTimeout = setTimeout(() => {
        hideNotification();
      }, 5000);
    }

    function hideNotification() {
      const notif = document.getElementById('notification');
      notif.classList.remove('show');
      if (notificationTimeout) {
        clearTimeout(notificationTimeout);
        notificationTimeout = null;
      }
    }

    // 1. CPU Stress Injection
    async function injectCpuStress() {
      const btn = document.querySelector('.btn-warning[onclick="injectCpuStress()"]');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span>‚è≥</span> Stressing...';
      btn.disabled = true;

      const service = document.getElementById('cpu-microservice').value.trim();
      const namespace = document.getElementById('cpu-namespace').value.trim();
      const duration = parseInt(document.getElementById('cpu-duration').value.trim(), 10);
      const waitBefore = parseInt(document.getElementById('cpu-waitBefore').value.trim(), 10);

      if (!namespace || !service) {
        showNotification('Please provide both namespace and microservice.', false);
        btn.innerHTML = originalText;
        btn.disabled = false;
        return;
      }

      showNotification('Injecting CPU stress...', true);

      try {
        const res = await fetch('/inject-cpu-faulttest', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ service, namespace, duration, waitBefore })
        });

        const data = await res.json();

        if (data.success) {
          showNotification(`CPU stress injected to ${service} in ${namespace} for ${duration}s: ${data.message}`, true);
        } else {
          showNotification(`Failed to inject CPU stress: ${data.error}`, false);
        }
      } catch (err) {
        showNotification(`Error injecting CPU stress: ${err.message}`, false);
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }

    // 2. Memory Stress Injection
    async function injectMemoryStress() {
      const btn = document.querySelector('.btn-warning[onclick="injectMemoryStress()"]');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span>‚è≥</span> Injecting...';
      btn.disabled = true;

      const namespace = document.getElementById('mem-namespace').value.trim();
      const service = document.getElementById('mem-service').value.trim();
      const memSize = document.getElementById('mem-amount').value.trim();
      const failureDuration = parseInt(document.getElementById('mem-duration').value.trim(), 10);
      const waitBefore = parseInt(document.getElementById('mem-waitBefore').value.trim(), 10);

      if (!namespace || !service || !memSize) {
        showNotification('Please provide namespace, service, and memory size.', false);
        btn.innerHTML = originalText;
        btn.disabled = false;
        return;
      }

      showNotification('Injecting memory stress...', true);

      try {
        const res = await fetch('/inject-memory-fault', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ service, namespace, memSize, failureDuration, waitBefore })
        });

        const data = await res.json();

        if (res.ok) {
          showNotification(`Memory stress (${memSize}) injected to ${service} in ${namespace} for ${failureDuration}s: ${data.message}`, true);
        } else {
          showNotification(`Failed to inject memory stress: ${data.error}`, false);
        }
      } catch (err) {
        showNotification(`Error injecting memory stress: ${err.message}`, false);
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }

    // 3. Network Loss Injection
    async function injectNetworkLoss() {
      const btn = document.querySelector('.btn-primary[onclick="injectNetworkLoss()"]');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span>‚è≥</span> Injecting...';
      btn.disabled = true;

      const namespace = document.getElementById('loss-namespace').value.trim();
      const service = document.getElementById('loss-microservice').value.trim();
      const lossPct = Number(document.getElementById('loss-percent').value);
      const duration = Number(document.getElementById('loss-duration').value);
      const waitBefore = Number(document.getElementById('loss-waitBefore').value) || 0;

      if (!namespace || !service) {
        showNotification('Please provide both namespace and microservice.', false);
        btn.innerHTML = originalText;
        btn.disabled = false;
        return;
      }

      showNotification('Injecting network loss...', true);

      try {
        const res = await fetch('/inject-network-loss', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ namespace, service, lossPct, duration, waitBefore }),
        });

        const text = await res.text();

        if (res.ok) {
          showNotification(`Network loss (${lossPct}%) injected to ${service} in ${namespace} for ${duration}s: ${text}`, true);
        } else {
          showNotification(`Failed to inject network loss: ${text}`, false);
        }
      } catch (err) {
        showNotification(`Error injecting network loss: ${err.message}`, false);
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }

    // 4. Network Delay Injection
    async function injectNetworkDelay() {
      const btn = document.querySelector('.btn-primary[onclick="injectNetworkDelay()"]');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span>‚è≥</span> Injecting...';
      btn.disabled = true;

      const namespace = document.getElementById('netdelay-namespace').value.trim();
      const service = document.getElementById('netdelay-microservice').value.trim();
      const delayMs = parseInt(document.getElementById('netdelay-ms').value, 10);
      const duration = parseInt(document.getElementById('netdelay-duration').value, 10);
      const waitBefore = parseInt(document.getElementById('netdelay-waitBefore').value, 10);

      if (!namespace || !service) {
        showNotification('Please provide both namespace and microservice.', false);
        btn.innerHTML = originalText;
        btn.disabled = false;
        return;
      }

      showNotification('Injecting network delay...', true);

      try {
        const res = await fetch('/inject-network-delay', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ namespace, service, delayMs, duration, waitBefore })
        });

        const text = await res.text();

        if (res.ok) {
          showNotification(`Network delay (${delayMs}ms) injected to ${service} in ${namespace} for ${duration}s: ${text}`, true);
        } else {
          showNotification(`Failed to inject network delay: ${text}`, false);
        }
      } catch (err) {
        showNotification(`Error injecting network delay: ${err.message}`, false);
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }

    // 5. Istio Delay Injection
    async function injectIstioDelay() {
      const btn = document.querySelector('.btn-primary[onclick="injectIstioDelay()"]');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span>‚è≥</span> Injecting...';
      btn.disabled = true;

      const namespace = document.getElementById('istio-namespace').value.trim();
      const services = document.getElementById('istio-service').value.split(',').map(s => s.trim()).filter(Boolean);
      const istioDelayMs = parseInt(document.getElementById('istioDelayMs').value, 10);
      const duration = parseInt(document.getElementById('istio-duration').value, 10);
      const waitBefore = parseInt(document.getElementById('istio-waitBefore').value, 10);

      if (!namespace || services.length === 0) {
        showNotification('Please provide namespace and at least one service.', false);
        btn.innerHTML = originalText;
        btn.disabled = false;
        return;
      }

      showNotification('Injecting Istio delay...', true);

      try {
        const res = await fetch('/inject-istio-delay', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ namespace, services, istioDelayMs, duration, waitBefore }),
        });

        const text = await res.text();

        if (res.ok) {
          showNotification(`Istio delay (${istioDelayMs}ms) injected to ${services.join(', ')} in ${namespace} for ${duration}s: ${text}`, true);
        } else {
          showNotification(`Failed to inject Istio delay: ${text}`, false);
        }
      } catch (err) {
        showNotification(`Error injecting Istio delay: ${err.message}`, false);
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }

    // 6. Load Generator Scaling
    async function cleanupLoadGenerator(event) {
      event.preventDefault();

      const btn = document.querySelector('.btn-danger[onclick="cleanupLoadGenerator(event)"]');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span>‚è≥</span> Scaling...';
      btn.disabled = true;

      const namespace = document.getElementById('load-namespace').value.trim();
      const users = parseInt(document.getElementById('load-users').value, 10);
      const duration = parseInt(document.getElementById('load-duration').value, 10);

      if (!namespace) {
        showNotification('Please provide a namespace.', false);
        btn.innerHTML = originalText;
        btn.disabled = false;
        return;
      }
      if (isNaN(users) || users < 1) {
        showNotification('Please provide a valid number of users (>= 1).', false);
        btn.innerHTML = originalText;
        btn.disabled = false;
        return;
      }
      if (isNaN(duration) || duration < 1) {
        showNotification('Please provide a valid duration (>= 1 second).', false);
        btn.innerHTML = originalText;
        btn.disabled = false;
        return;
      }

      showNotification('Scaling load generator...', true);

      try {
        const res = await fetch('/scale-loadgenerator', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ namespace, users, duration }),
        });

        const text = await res.text();

        if (res.ok) {
          showNotification(`Load generator scaled to ${users} replicas in ${namespace} for ${duration}s: ${text}`, true);
        } else {
          showNotification(`Failed to scale load generator: ${text}`, false);
        }
      } catch (err) {
        showNotification(`Error scaling load generator: ${err.message}`, false);
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }
  </script>
</body>
</html>